---
- hosts: all
  remote_user: pi
  become_user: root
  become_method: sudo
  tasks:
    # basic packages
    - name: update package index
      apt: update_cache=yes
      become: yes
    - name: install basic packages
      apt: name={{item}} state=present
      become: yes
      with_items:
        - htop
        - sudo
        - tmux
        - mosh
        - iotop
        - vim
        - rsync
        - unzip
        - git
        - raspi-config
        - rpi-update
    - name: install requirements
      apt: name={{item}} state=present
      become: yes
      with_items:
        - gcc
        - make
        - python3
        - python3-pip
    - name: upgrade python pip
      command: easy_install3 -U pip
      become: yes
    - name: clone kati repo
      git: repo=git@github.com:techSU/kati.git dest=/home/pi/kati/ update=yes accept_hostkey=yes
    - name: install kati python requirements
      pip: executable=pip3 requirements=/home/pi/kati/requirements.txt
      become: yes
    - name: install pigpio
      script: install_pigpio.sh chdir=/home/pi/pigpio creates=/usr/local/bin/pigpiod
      become: yes
    - name: start pigpio daemon
      command: pigpiod creates=/var/run/pigpio.pid
      become: yes
